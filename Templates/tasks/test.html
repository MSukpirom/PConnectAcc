{% extends 'tasks/base.html' %}
{% block content %}

    <form action="{% url 'Taskscontroller:RegisterForm' %}" method="post">
        {% csrf_token %}

            <label for="c_code">รหัสลูกค้า:</label>
            <input type="text" id="c_code" name="c_code" required>

            <label for="c_company_name">ชื่อบริษัท:</label>
            <input type="text" id="c_company_name" name="c_company_name" required>

            <label for="c_tin_id">เลขที่นิติ:</label>
            <input type="text" id="c_tin_id" name="c_tin_id" required>

            <label for="c_create_data">วันที่สร้าง:</label>
            <input type="date" id="c_create_data" name="c_create_data" required>

            <label for="c_service_fee">ค่าบริการ:</label>
            <input type="text" id="c_service_fee" name="c_service_fee" required>

            <label for="c_address">ที่อยู่บริษัท:</label>
            <input type="text" id="c_address" name="c_address" required>

            <label for="province">จังหวัด:</label>
            <select id="province" name="province" required>
                <option value="" selected disabled hidden>เลือกจังหวัด</option>
                {% for p in province %}
                    <option value="{{ p.id }}">{{ p.name_th }}</option>
                {% endfor %}
            </select>

            <label for="district">อำเภอ:</label>
            <select id="district" name="district" required>
                <option value="" selected disabled hidden>เลือกอำเภอ</option>
            </select>

            <label for="subdistrict">ตำบล:</label>
            <select id="subdistrict" name="subdistrict" required>
                <option value="" selected disabled hidden>เลือกตำบล</option>
            </select>

            <label for="c_channal">ช่องทางรู้จักเรา:</label>
            <input type="text" id="c_channal" name="c_channal" required>

            <label for="c_detail">รายละเอียด:</label>
            <input type="text" id="c_detail" name="c_detail" required>

            <button type="submit">บันทึก</button>
    </form>

    <form action="{% url 'Taskscontroller:RegisterForm' %}" method="post" class="form-container">
    {% csrf_token %}
        <div class="grid gap-6 mb-6 md:grid-cols-2">
            <div class="form-group">
                <label for="c_code">รหัสลูกค้า:</label>
                <input type="text" id="c_code" required>
            </div>
            <div class="form-group">
                <label for="c_company_name">ชื่อบริษัท:</label>
                <input type="text" id="c_company_name" required>
            </div>
            <div class="form-group">
                <label for="c_tin_id">เลขที่นิติ:</label>
                <input type="text" id="c_tin_id" required>
            </div>
            <div class="form-group">
                <label for="c_create_data">วันที่สร้าง:</label>
                <input type="date" id="c_create_data" pattern="[0-9]{3}-[0-9]{2}-[0-9]{3}" required>
            </div>
            <div class="form-group">
                <label for="c_service_fee">ค่าบริการ:</label>
                <input type="number" id="c_service_fee" required>
            </div>
            <div class="form-group">
                <label for="c_address">ที่อยู่บริษัท:</label>
                <input type="text" id="c_address" required>
            </div>
        </div>

        <div class="mb-6">
            <label for="province">จังหวัด:</label>
            <select id="province" name="province" required>
                <option value="" selected disabled hidden>เลือกจังหวัด</option>
                {% for p in province %}
                    <option value="{{ p.id }}">{{ p.name_th }}</option>
                {% endfor %}
            </select>
        </div>

        <button type="submit" class="submit-button">Submit</button>
    </form>



    <script type="text/javascript">
        $(function() {
            // Load provinces into the province select dropdown
            $.ajax({
                url: '{% url 'Taskscontroller:GetProvinces' %}',
                success: function(data) {
                    var $selectProvince = $('#province');
                    $selectProvince.empty();
                    $selectProvince.append('<option value="" selected disabled hidden>เลือกจังหวัด</option>');
                    $.each(data, function(index, province) {
                        $selectProvince.append($('<option>', {
                            value: province.id,
                            text: province.name_th
                        }));
                    });
                }
            });

            // Handle province change event
            $('#province').change(function() {
                var selectedProvinceId = $(this).val();
                if (selectedProvinceId) {
                    // Load districts based on the selected province
                    $.ajax({
                        url: '{% url 'Taskscontroller:GetDistrict' %}',
                        data: { province_id: selectedProvinceId },
                        success: function(data) {
                            var $selectDistrict = $('#district');
                            $selectDistrict.empty();
                            $selectDistrict.append('<option value="" selected disabled hidden>เลือกอำเภอ</option>');
                            $.each(data, function(index, district) {
                                $selectDistrict.append($('<option>', {
                                    value: district.id,
                                    text: district.name_th
                                }));
                            });
                        }
                    });
                } else {
                    // Clear and disable district and subdistrict select dropdowns
                    $('#district').empty().prop('disabled', true);
                    $('#subdistrict').empty().prop('disabled', true);
                }
            });

            // Handle district change event
            $('#district').change(function() {
                var selectedDistrictId = $(this).val();
                if (selectedDistrictId) {
                    // Load subdistricts based on the selected district
                    $.ajax({
                        url: '{% url 'Taskscontroller:GetSubdistrict' %}',
                        data: { district_id: selectedDistrictId },
                        success: function(data) {
                            var $selectSubdistrict = $('#subdistrict');
                            $selectSubdistrict.empty();
                            $selectSubdistrict.append('<option value="" selected disabled hidden>เลือกตำบล</option>');
                            $.each(data, function(index, subdistrict) {
                                $selectSubdistrict.append($('<option>', {
                                    value: subdistrict.id,
                                    text: subdistrict.name_th + ' - ' + subdistrict.postcode
                                }));
                            });
                        }
                    });
                } else {
                    // Clear and disable subdistrict select dropdown
                    $('#subdistrict').empty().prop('disabled', true);
                }
            });
        });
    </script>

{% endblock content %}